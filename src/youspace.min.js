var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.owns=function(c,e){return Object.prototype.hasOwnProperty.call(c,e)};$jscomp.assign="function"==typeof Object.assign?Object.assign:function(c,e){for(var d=1;d<arguments.length;d++){var f=arguments[d];if(f)for(var k in f)$jscomp.owns(f,k)&&(c[k]=f[k])}return c};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(c,e,d){c!=Array.prototype&&c!=Object.prototype&&(c[e]=d.value)};$jscomp.getGlobal=function(c){return"undefined"!=typeof window&&window===c?c:"undefined"!=typeof global&&null!=global?global:c};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(c,e,d,f){if(e){d=$jscomp.global;c=c.split(".");for(f=0;f<c.length-1;f++){var k=c[f];k in d||(d[k]={});d=d[k]}c=c[c.length-1];f=d[c];e=e(f);e!=f&&null!=e&&$jscomp.defineProperty(d,c,{configurable:!0,writable:!0,value:e})}};$jscomp.polyfill("Object.assign",function(c){return c||$jscomp.assign},"es6","es3");
(function(c,e){"object"===typeof exports&&"undefined"!==typeof module?e(exports):"function"===typeof define&&define.amd?define(["exports"],e):e(c.YOUSPACE={})})(this,function(c){function e(){this.state=h.NONE;this.timestamp=l.now()}function d(a){a=a||{};e.call(this);this.minTriggerDistance=a.minTriggerDistance||200;this.minPersistentTriggerDuration=a.minPersistentTriggerDuration||100;this.minFrameCount=a.minFrameCount||5;this.maxFrameCount=a.maxFrameCount||40;this.minTriggerVelocity=a.minTriggerVelocity||
20;this.postTriggerDelay=a.postTriggerDelay||220;this.framecount=0;this.lastScreenPosition={x:0,y:0};this.velocityHistory={x:0,y:0};this.duration=this.startTimeStamp=0}function f(){}function k(a,b){a=a||{};this.ScreenResolution=a.resolution||{width:1920,height:1080};this.ScreenConfig={width:3660,height:2058.75,center:{x:0,y:80,z:0}};this.Controller=b;this.Persons={};this.GoneCountdown=a.GoneCountdown||3E3}function p(a,b,c){a=a||{};this.WebsocketURL=a.hostURL||"ws://localhost:32343";this.WebsocketProtocol=
a.protocol||"youspace-websocket-protocol";this.retryTime=a.retryTime||2E3;this.DataHandler=b||{};this.Controller=c;this.interface={};this.connection={}}function m(a){a=a||{};this.LocalServerURL="http://localhost:9988";this.DataHandler=new k(a,this);this.WebSocket=new p(a,this.DataHandler,this)}var g={LEFT:0,RIGHT:1},h={NONE:-1,START:0,MOVE:1,END:2},n={YSCONFIG:0,YSPERSON:1},l="undefined"!==typeof window&&"undefined"!==typeof window.performance?window.performance:Date;Object.assign(e.prototype,{update:function(){}});
d.prototype=Object.create(e.prototype);d.prototype.constructor=d;d.prototype.cancel=function(){this.framecount=0;this.velocityHistory.x=0;this.startTimeStamp=this.duration=this.velocityHistory.y=0;switch(this.state){case h.START:case h.MOVE:this.state=h.END;this.timestamp=l.now()+this.postTriggerDelay;break;case h.END:this.state=h.NONE,this.timestamp=l.now()+this.postTriggerDelay}};d.prototype.update=function(a,b,c){a>this.minTriggerDistance&&c&&this.state!==h.END?l.now()>this.timestamp+this.minPersistentTriggerDuration&&
(this.state===h.NONE||this.state===h.END?(this.state=h.START,this.framecount=0,this.lastScreenPosition.x=b.x,this.lastScreenPosition.y=b.y,this.velocityHistory.x=0,this.velocityHistory.y=0,this.startTimeStamp=l.now(),this.duration=0):(a=b.x-this.lastScreenPosition.x,c=b.y-this.lastScreenPosition.y,this.framecount++,this.velocityHistory.x=this.velocityHistory.x*this.framecount+a,this.velocityHistory.y=this.velocityHistory.y*this.framecount+c,this.velocityHistory.x/=this.framecount,this.velocityHistory.y/=
this.framecount,this.lastScreenPosition.x=b.x,this.lastScreenPosition.y=b.y,this.framecount>=this.minFrameCount&&(Math.abs(this.velocityHistory.x)>=this.minTriggerVelocity||Math.abs(this.velocityHistory.y)>=this.minTriggerVelocity)&&(this.state=h.MOVE,this.duration=l.now()-this.startTimeStamp),this.framecount>this.maxFrameCount&&this.cancel())):this.cancel();return{status:this.state,data:b}};Object.assign(f.prototype,{addEventListener:function(a,b){void 0===this._listeners&&(this._listeners={});var c=
this._listeners;void 0===c[a]&&(c[a]=[]);-1===c[a].indexOf(b)&&c[a].push(b)},hasEventListener:function(a,b){if(void 0===this._listeners)return!1;var c=this._listeners;return void 0!==c[a]&&-1!==c[a].indexOf(b)},removeEventListener:function(a,b){void 0!==this._listeners&&(a=this._listeners[a],void 0!==a&&(b=a.indexOf(b),-1!==b&&a.splice(b,1)))},dispatchEvent:function(a){if(void 0!==this._listeners){var b=this._listeners[a.type];if(void 0!==b){a.target=this;b=b.slice(0);for(var c=0,d=b.length;c<d;c++)b[c].call(this,
a)}}}});Object.assign(k.prototype,{handleSocketDataTypeArray:function(a,b,c){switch(a){case n.YSCONFIG:this.updateScreenConfigTypeArray(b.subarray(1));break;case n.YSPERSON:a=c.getInt32(4,!0),this.decodeYSPersonMessageTypeArray(a,b.subarray(2))}},updateScreenConfigTypeArray:function(a){this.ScreenConfig.width=a[0];this.ScreenConfig.height=a[1];this.ScreenConfig.center.x=a[2];this.ScreenConfig.center.y=a[3];this.ScreenConfig.center.z=a[4]},decodeYSPersonMessageTypeArray:function(a,b){var c=b.length/
a;for(var d=0;d<a;d++){var e=d*c;var f=e+c;this.updatePersonDataTypeArray(b.subarray(e,f))}},onPersonDetected:function(a){this.Controller.dispatchEvent({type:"PersonDetected",message:a})},onPersonGone:function(a){this.Controller.dispatchEvent({type:"PersonGone",message:a})},updatePersonDataTypeArray:function(a){var b={};b.personId=a[0];b.personIterator=a[1];b.head={x:a[2],y:a[3],z:a[4]};b.torso={x:a[5],y:a[6],z:a[7]};b.leftArm={x:a[8],y:a[9],z:a[10]};b.rightArm={x:a[11],y:a[12],z:a[13]};b.leftLeg=
{x:a[14],y:a[15],z:a[16]};b.rightLeg={x:a[17],y:a[18],z:a[19]};b.hasLeftHand=1===Math.floor(a[20])?!0:!1;b.hasRightHand=1===Math.floor(a[21])?!0:!1;b.leftHand={x:a[22],y:a[23],z:a[24]};b.rightHand={x:a[25],y:a[26],z:a[27]};b.leftHandPointing={x:a[28],y:a[29],z:a[30]};b.rightHandPointing={x:a[31],y:a[32],z:a[33]};b.processingTime=Math.floor(a[34]);b.pointsMean={x:a[35],y:a[36],z:a[37]};b.bodyHeight=a[38];b.hipGirth=a[39];b.waistGirth=a[40];b.bustChestGirth=a[41];b.waistHeight=a[42];b.leftHandDirection=
{x:a[43],y:a[44],z:a[45]};b.rightHandDirection={x:a[46],y:a[47],z:a[48]};b.torsoHeading=a[49];b.leftHandDirectionPointing={x:a[50],y:a[51],z:a[52]};b.rightHandDirectionPointing={x:a[53],y:a[54],z:a[55]};b.timestamp=Math.round(a[56]);b.leftHandGesture={hasGesture:1===Math.round(a[57])?!0:!1,type:Math.round(a[58]),direction:Math.round(a[59]),position:{x:a[60],y:a[61],z:a[62]}};b.rightHandGesture={hasGesture:1===Math.round(a[63])?!0:!1,type:Math.round(a[64]),direction:Math.round(a[65]),position:{x:a[66],
y:a[67],z:a[68]}};this.updatePersonList(b);this.detectPrimaryHand(b);this.detectGesture(b);this.Controller&&this.Controller.dispatchEvent({type:"PersonUpdate",message:b})},updatePersonList:function(a){var b=this.Persons[a.personId];0<=a.personId&&(b?(a.primaryHand=b.primaryHand,a.primaryHandLabel=b.primaryHandLabel,a.hasPrimaryHand=b.hasPrimaryHand,a.primaryHandPointing=null,a.primaryHandDirection=null,a.gesture=b.gesture,a.leaveTimerId=b.leaveTimerId,clearTimeout(a.leaveTimerId)):(a.gesture={swipe:{detector:{leftHand:new d(this.SwipeDetectionConfig),
rightHand:new d(this.SwipeDetectionConfig)}}},this.onPersonDetected(a)),a.leaveTimerId=setTimeout(this.onPersonGone.bind(this,a),this.GoneCountdown),this.Persons[a.personId]=a)},detectPrimaryHand:function(a){var b=this.Persons[a.personId];if(b)switch(b.primaryHandLabel||(a.hasLeftHand?b.primaryHandLabel=g.LEFT:a.hasRightHand&&(b.primaryHandLabel=g.RIGHT)),a.hasLeftHand&&b.primaryHandLabel===g.LEFT?(a.primaryHandLabel=g.LEFT,a.hasPrimaryHand=!0):a.hasRightHand&&b.primaryHandLabel===g.RIGHT?(a.primaryHandLabel=
g.RIGHT,a.hasPrimaryHand=!0):(a.primaryHandLabel=null,a.hasPrimaryHand=!1),a.primaryHandLabel){case g.LEFT:a.primaryHand=a.leftHand;a.primaryHandPointing=a.leftHandPointing;a.primaryHandDirection=a.leftHandDirection;break;case g.RIGHT:a.primaryHand=a.rightHand;a.primaryHandPointing=a.rightHandPointing;a.primaryHandDirection=a.rightHandDirection;break;default:a.primaryHandPointing=null,a.primaryHandDirection=null,a.primaryHand=null}},detectGesture:function(a){var b=a.gesture.swipe,c=a.gesture.swipe.detector.leftHand,
d=a.gesture.swipe.detector.rightHand,e=this.mapToScreenSpace(a.leftHand),f=this.mapToScreenSpace(a.rightHand);b.leftHand=c.update(a.leftHand.z-a.torso.z,e,a.hasLeftHand);b.rightHand=d.update(a.rightHand.z-a.torso.z,f,a.hasRightHand);switch(a.primaryHandLabel){case g.LEFT:b.primaryHand=b.leftHand;b.detector.primaryHand=b.detector.leftHand;break;case g.RIGHT:b.primaryHand=b.rightHand,b.detector.primaryHand=b.detector.rightHand}},normalize:function(a,b){b=b||{x:0,y:0,z:0};b.x=-(a.x-this.ScreenConfig.center.x)/
this.ScreenConfig.width;b.y=(a.y-this.ScreenConfig.center.y)/this.ScreenConfig.height;b.z=0;return b},mapToScreenSpace:function(a){var b={};b.x=-(a.x-this.ScreenConfig.center.x)/this.ScreenConfig.width+.5;b.y=.5-(a.y-this.ScreenConfig.center.y)/this.ScreenConfig.height;b.z=-(a.z-this.ScreenConfig.center.z)/this.ScreenConfig.width;"undefined"===typeof window?(b.x*=this.ScreenResolution.width,b.y*=this.ScreenResolution.height):(b.x*=window.innerWidth,b.y*=window.innerHeight);return b},mapFromScreenSpace:function(a){a=
{x:a.x,y:a.y,z:a.z};"undefined"===typeof window?(a.x/=this.ScreenResolution.width,a.y/=this.ScreenResolution.height):(a.x/=window.innerWidth,a.y/=window.innerHeight);a.x=this.ScreenConfig.center.x-this.ScreenConfig.width*(a.x-.5);a.y=this.ScreenConfig.center.y-this.ScreenConfig.height*(a.y-.5);a.z=.5;return a},getTorsoToPrimaryHandVector:function(a){var b={x:0,y:0,z:0};switch(a.primaryHandLabel){case g.LEFT:b.x=a.leftHand.x-a.torso.x;b.y=a.leftHand.y-a.torso.y;b.z=a.leftHand.z-a.torso.z;break;case g.RIGHT:b.x=
a.rightHand.x-a.torso.x,b.y=a.rightHand.y-a.torso.y,b.z=a.rightHand.z-a.torso.z}return b}});Object.assign(p.prototype,{connect:function(a){!this.interface&&a&&(this.interface=a);var b=this.DataHandler,c=this.retryTime;a=new ("undefined"!==typeof window?window.WebSocket:this.interface)(this.WebsocketURL,this.WebsocketProtocol);a.binaryType="arraybuffer";a.onmessage=function(a){var c=a.data||a.utf8Data;if("object"===typeof c){a=new Float32Array(c);c=new DataView(c);var d=c.getInt32(0,!0);b.handleSocketDataTypeArray(d,
a,c)}};a.onclose=function(){console.log("Websocket Connection Closed. Reconnecting...");setTimeout(this.connect.bind(this),c)}.bind(this);a.onerror=function(){console.log("Websocket Connection Error...")};this.connection=a;return this.Controller},disconnect:function(){this.connection&&(this.connection.close(),this.connection=null);return this.Controller}});m.prototype=Object.assign(Object.create(f.prototype),{constructor:m,connect:function(a){return this.WebSocket.connect(a)},disconnect:function(){return this.WebSocket.disconnect()},
normalize:function(a,b){return this.DataHandler.normalize(a,b)},mapToScreenSpace:function(a){return this.DataHandler.mapToScreenSpace(a)},mapFromScreenSpace:function(a){return this.DataHandler.mapFromScreenSpace(a)},getTorsoToPrimaryHandVector:function(a){return this.DataHandler.getTorsoToPrimaryHandVector(a)},sendMessageToServer:function(a,b){if("undefined"!==typeof window&&window.XMLHttpRequest){var c=new window.XMLHttpRequest;c.open("GET",this.LocalServerURL+"?"+a+"="+b);c.send();return c}}});
c.Controller=m;c.VERSION="2.4.0";c.LABEL=g;c.STATE=h;c.PURPOSE=n;c.WEBSOCKET_HOST="ws://localhost:32343";c.WEBSOCKET_PROTOCOL="youspace-websocket-protocol";c.LOCAL_SERVER_HOST="http://localhost:9988";c.TIME=l;Object.defineProperty(c,"__esModule",{value:!0})});
